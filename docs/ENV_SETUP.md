# Environment Variables

Environment variables are stored in files but are divided by application and deployment target.

## Environment Files Structure

The project uses a dual environment file system to support both development and production deployments:

- **`.env`**: Used for local development (DATABASE_HOST=localhost:5432)
- **`.env.production`**: Used for Docker/production deployments (DATABASE_HOST=db:5432)
- **`.env.example`**: Template file with all available variables

### File Priority System

When running Docker deployment scripts, the system loads environment variables with the following priority:

1. **`.env.production`** (if exists) - Takes precedence for Docker deployments
2. **`.env`** (fallback) - Used if .env.production doesn't exist

### Automatic File Creation

For development and local deployment, either copy the `.env.example` file to `.env` manually or run `npm run setup:env`.
This will automatically create both files:

- **`.env`** with `DATABASE_HOST=localhost:5432` (for local development)
- **`.env.production`** with `DATABASE_HOST=db:5432` (for Docker deployments)

The setup script will populate both files with default values. However, for improved application security, it is recommended to replace these defaults with your own custom values.

All applications retrieve the necessary variables from these files.

There are also `.env` files inside `packages/prisma`, `apps/app`, `apps/api` and `docker` folder that directly link to the `.env` file in project root. Do not touch them.

## Docker Deployment

When using Docker deployment via `npm run docker`, the system automatically:

1. **Checks for environment files** and creates them if missing
2. **Loads the appropriate environment file** with priority to `.env.production`
3. **Passes the environment file to Docker Compose** using the `--env-file` flag
4. **Ensures all containers receive the correct environment variables**

### Environment File Selection for Docker

- If `.env.production` exists → Uses `.env.production` (recommended for Docker deployments)
- If only `.env` exists → Falls back to `.env`
- If neither exists → Automatically creates both from `.env.example`

This ensures that Docker containers always receive the correct database host (`db:5432` instead of `localhost:5432`) and other production-specific configurations.

## Database

```env
POSTGRES_USER=poveroh
POSTGRES_PASSWORD=poveroh
POSTGRES_DB=poveroh

# For local development, the host is 'localhost:5432'
# For local deploy (docker), the host is 'db:5432'
# For production, insert url you need
DATABASE_HOST=db:5432

#Database connection string for Prisma; don't touch this
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${DATABASE_HOST}/${POSTGRES_DB}
```

## Api

```env
#API port; default is 3001
API_PORT=3001

# JWT secret key
# If missing and you run project's setup script, it will generated by default
JWT_KEY=

#Storage

# File storage mode; must be one of the following: local | aws | gcloud | azure | digitalocean
FILE_STORAGE_MODE=local

# For local storage, type full path of folder on your computer (es. /Users/<user>/data-folder)
# If missing and you run project's setup script, it will be set default folder (./cdn-data)
CDN_LOCAL_DATA_PATH=/Users/<user>/cdn-data

AWS_BUCKET=
AWS_REGION=
AWS_CREDENTIALS_ACCESSKEYID=
AWS_CREDENTIALS_SECRETACCESSKEY=

GCS_BUCKET=
GCS_PROJECTID=

DIGITALOCEAN_BUCKET=
DIGITALOCEAN_REGION=
DIGITALOCEAN_ENDPOINT=
DIGITALOCEAN_CREDENTIALS_ACCESSKEYID=
DIGITALOCEAN_CREDENTIALS_SECRETACCESSKEY=

AZURE_CONNECTION_STRING=
AZURE_CONTAINER=
```

## App

```env
#API url; default is localhost:3001 - get the port from the API_PORT variable
NEXT_PUBLIC_API_URL=http://localhost:${API_PORT}
NEXT_PUBLIC_APP_VERSION=1.0.0
NEXT_PUBLIC_APP_NAME=Poveroh

# Base URL for the application (required for production when using cross-subdomain cookies)
# For development, this can be left empty
# For production, set to your domain (e.g., https://yourdomain.com)
BASE_URL=
```

## Docker

```env
# Set the base name for Docker containers created by Docker Compose
COMPOSE_PROJECT_NAME=poveroh
```
